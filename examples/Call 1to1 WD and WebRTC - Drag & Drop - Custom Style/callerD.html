<!-- This file is used by the caller, used name is caller_uid, and it calls the callee named calle_uid -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>My Weemo Application: Caller</title>
    <script type="text/javascript" src="https://download.weemo.com/js/webappid/YOUR_APP_IDENTIFIER"></script>
    <script type="text/javascript" src="WeemoDragNDrop.js"></script>
    <link rel="stylesheet" type="text/css" href="customWeemoCss.css">
<style type="text/css">
    body {
        font-family: Helvetica;
    }
</style>
</head>
<body>
    <script type="text/javascript">
        if(window.location.protocol === 'file:'){alert('your project must be served from a webserver and not from the file system');}
        var realTimeClient = "",
            //Define the optional parameters
            weemo = {},
            options = {
                debugLevel : 1, 
                defaultStyle : false,
                displayName : 'Caller'
            },
            //Intialize Weemo Function
            initializeWeemo = function () {
                // Initialize the Main Object with App Identifier, Token, WeemoType, options
                weemo = new Weemo("YOUR_APP_IDENTIFIER", "caller_uid", "internal", options);
                // Call if the WeemoDriver is not running on the client computer and if the browser is not WebRTC-capable
                weemo.onWeemoDriverNotStarted = function(downloadUrl) {
                    var answer = confirm('Click OK to download and install the Weemo client.');
                    if (answer == true)
                        window.location = downloadUrl;
                };
                // Get the Connection Handler callback when the JavaScript is connected to real-time client
                weemo.onConnectionHandler = function(message, code) {
                    if(window.console)
                        console.log("Connection Handler : " + message + ' ' + code);
                    switch(message) {
                        case 'connectedWeemoDriver':
                            realTimeClient = "WeemoDriver";
                        break; 
                        case 'connectedWebRTC':
                            realTimeClient = "WebRTC";
                        break; 
                        case 'sipOk':
                            document.getElementById('connecting').style.color = "#CCCCCC";
                            document.getElementById('stat').innerHTML = "Connected as Caller using "+realTimeClient;
                            document.getElementById('buttonCall').style.display = "block";
                        break;
                        case 'loggedasotheruser':
                        // force connection, kick other logged users
                            weemo.authenticate(1);
                        break;
                    }
                };
                // Declare a variable "weemodragndrop" for drag and drop uses
                var weemodragndrop;
                // This function permits to catch events comming from the call
                weemo.onCallHandler = function(callObj, args) {
                    if (args.type == "call" && args.status == "callCreated") {
                        document.getElementById('call').innerHTML = "Calling...";
                    } else if (args.type == "call" && args.status == "active") {
                        document.getElementById('call').innerHTML = "Call active";
                    } else if (args.type == "call" && args.status == "terminated") {
                        document.getElementById('call').innerHTML = "";
                    } else if(args.type == 'webRTCcall' && args.status == 'callCreated') {
                        document.getElementById('call').innerHTML = "Calling...";            
                    } else if(args.type == 'webRTCcall' && args.status == 'active') {
                        document.getElementById('call').innerHTML = "Call active";
                         // Drag and Drop initialization
                        weemodragndrop = WeemoDragNDrop();
                        weemodragndrop.init();
                    } else if (args.type == "webRTCcall" && args.status == "terminated") {
                        document.getElementById('call').innerHTML = "";
                        if(weemodragndrop !== undefined && weemodragndrop.hasOwnProperty('destroy'))
                            weemodragndrop.destroy();
                    }
                };
                //Initialize connection between the real-time client and the browser
                weemo.initialize();   
            },
            // Test if browser is IE10
            isIE10 = false,
            // Poll for jQuery to come into existence
            checkReady = function(callback) {
                if (window.jQuery) {
                    callback();
                } else {
                    window.setTimeout(function() { checkReady(callback); }, 100);
                }
            };

        /*@cc_on
            if (/^10/.test(@_jscript_version)) {
                isIE10 = true;
            }
        @*/

        if (isIE10) {
            options.useJquery = true;
            var script = document.createElement("SCRIPT");
            script.src = 'http://code.jquery.com/jquery-latest.min.js';
            script.type = 'text/javascript';
            document.getElementsByTagName("head")[0].appendChild(script);
            // Start polling...
            checkReady(initializeWeemo);
        } else {
            options.useJquery = false;
            initializeWeemo(); 
        }
    </script>
    <h3>Welcome to Weemo HelloWorld App</h3>
    <h4 id="connecting">Connecting as Caller...</h4>
    <h4 id="stat"></h4>
    <button style="display:none;" id="buttonCall" onclick="weemo.createCall('callee_uid', 'internal', 'Callee');">Click to call Callee</button>
    <h4 id="call"></h4>
</body>
</html>
